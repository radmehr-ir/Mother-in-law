<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8">
<title>یادآور - مادریار هوشمند</title>
<link rel="stylesheet" href="style.css">
</head>
<body>

<nav>
  <a href="index.html">🏠 خانه</a>
  <a href="shopping.html">🛒 لیست خرید</a>
  <a href="reminder.html">⏰ یادآور</a>
</nav>

<h2>⏰ یادآور</h2>
<input type="datetime-local" id="reminderTime">
<input type="text" id="reminderText" placeholder="یادآوری...">
<select id="repeatType">
  <option value="once">یکبار</option>
  <option value="daily">هر روز</option>
  <option value="monthly">هر ماه</option>
  <option value="yearly">هر سال</option>
</select>
<button onclick="setReminder()">📌 ثبت یادآور</button>

<h3>📋 لیست یادآورها</h3>
<ul id="reminderList"></ul>

<audio id="alarmSound" src="https://dl4.fara-download.ir/audio/sound_effect/alarms/phone/iphone/iPhone%20notification%20sound.mp3"></audio>

<script>
let reminders = JSON.parse(localStorage.getItem("reminders") || "[]");

// درخواست اجازه اعلان
if (Notification.permission !== "granted") {
  Notification.requestPermission();
}

function renderReminders() {
  document.getElementById("reminderList").innerHTML = reminders.map((r, i) =>
    `<li>${r.text} - ${new Date(r.time).toLocaleString()} (${r.repeat})</li>`
  ).join("");
}

function setReminder() {
  let time = new Date(document.getElementById("reminderTime").value).getTime();
  let text = document.getElementById("reminderText").value;
  let repeat = document.getElementById("repeatType").value;
  if (!time || !text) return alert("زمان و متن را وارد کنید");

  reminders.push({ time, text, repeat });
  localStorage.setItem("reminders", JSON.stringify(reminders));

  renderReminders();
  alert("✅ یادآور ثبت شد");
}

function showNotification(msg) {
  if (Notification.permission === "granted") {
    new Notification("⏰ یادآور", { body: msg });
  }
}

function checkReminders() {
  let now = Date.now();
  reminders.forEach((r, index) => {
    if (now >= r.time) {
      document.getElementById("alarmSound").play();
      showNotification(r.text);

      if (r.repeat === "daily") {
        r.time += 24 * 60 * 60 * 1000;
      } else if (r.repeat === "monthly") {
        let date = new Date(r.time);
        date.setMonth(date.getMonth() + 1);
        r.time = date.getTime();
      } else if (r.repeat === "yearly") {
        let date = new Date(r.time);
        date.setFullYear(date.getFullYear() + 1);
        r.time = date.getTime();
      } else {
        reminders.splice(index, 1); // یکبار
      }

      localStorage.setItem("reminders", JSON.stringify(reminders));
      renderReminders();
    }
  });
}

renderReminders();
setInterval(checkReminders, 1000);
</script>

</body>
</html>
